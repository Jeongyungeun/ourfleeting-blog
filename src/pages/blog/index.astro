---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";

const allPosts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// 카테고리 추출 함수 (폴더명)
function getCategory(postId: string): string {
	const parts = postId.split("/");
	return parts.length > 1 ? parts[0] : "uncategorized";
}

// 모든 카테고리 목록 생성
const categories = [
	"all",
	...new Set(allPosts.map((post) => getCategory(post.id))),
];

// 카테고리 이름 표시용
const categoryLabels: Record<string, string> = {
	all: "전체",
	life: "Life",
	family: "Family",
	friends: "Friends",
};
---

<Layout title="Blog" description="모든 블로그 포스팅">
	<section class="py-8">
		<h1 class="text-4xl font-bold text-slate-900 mb-8 text-center">
			블로그
		</h1>

		<!-- 카테고리 필터 탭 -->
		<div
			class="flex gap-2 mb-10 overflow-x-auto pb-2 justify-center flex-wrap"
		>
			{
				categories.map((cat) => (
					<a
						href={cat === "all" ? "/blog" : `/blog/category/${cat}`}
						class:list={[
							"px-5 py-2.5 rounded-full font-medium transition-all whitespace-nowrap",
							cat === "all"
								? "bg-primary-600 text-white shadow-lg shadow-primary-500/30 scale-105"
								: "bg-slate-100 text-slate-600 hover:bg-slate-200 hover:scale-105",
						]}
					>
						{categoryLabels[cat] || cat}
					</a>
				))
			}
		</div>

		<!-- 포스트 목록 -->
		<ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
			{
				allPosts.map((post) => (
					<Card
						title={post.data.title}
						date={post.data.pubDate}
						body={post.data.description}
						href={`/blog/${post.id}/`}
						image={post.data.heroImage}
					/>
				))
			}
		</ul>
	</section>
</Layout>
