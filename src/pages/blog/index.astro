---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";

const allPosts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// 카테고리 추출 함수 (폴더명)
function getCategory(postId: string): string {
	const parts = postId.split("/");
	return parts.length > 1 ? parts[0] : "uncategorized";
}

// 모든 카테고리 목록 생성
const categories = [
	"all",
	...new Set(allPosts.map((post) => getCategory(post.id))),
];

// 카테고리 이름 표시용
const categoryLabels: Record<string, string> = {
	all: "전체",
	life: "Life",
	family: "Family",
	friends: "Friends",
};

// 필터 버튼 카테고리별 스타일
const filterButtonStyles: Record<string, string> = {
	all: "filter-btn active",
	life: "category-tag-solid category-tag-solid-blog",
	family: "category-tag-solid category-tag-solid-family",
	friends: "category-tag-solid category-tag-solid-marketing",
};
---

<Layout title="Blog" description="모든 블로그 포스팅">
	<div class="max-w-7xl mx-auto px-4 py-8">
		<section class="py-8">
			<h1 class="text-4xl font-bold text-[#1A1A2E] mb-8 text-center title-uppercase">
				Blog
			</h1>

			<!-- 카테고리 필터 탭 -->
			<div class="flex gap-3 mb-10 overflow-x-auto pb-2 justify-center flex-wrap">
				{
					categories.map((cat) => {
						const isActive = cat === "all";
						let btnClass = "";

						if (isActive) {
							btnClass = "filter-btn active";
						} else if (cat === "family") {
							btnClass = "category-tag-solid category-tag-solid-family";
						} else if (cat === "life") {
							btnClass = "category-tag-solid category-tag-solid-blog";
						} else {
							btnClass = "category-tag-solid category-tag-solid-marketing";
						}

						return (
							<a
								href={cat === "all" ? "/blog" : `/blog/category/${cat}`}
								class={btnClass}
							>
								{categoryLabels[cat] || cat}
							</a>
						);
					})
				}
			</div>

			<!-- 포스트 목록 -->
			<ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
				{
					allPosts.map((post, index) => {
						const variants = ['purple', 'mint', 'yellow', 'pink'] as const;
						const variant = variants[index % variants.length];
						const postCategory = getCategory(post.id) as 'family' | 'life';

						return (
							<Card
								title={post.data.title}
								date={post.data.pubDate}
								body={post.data.description}
								href={`/blog/${post.id}/`}
								image={post.data.heroImage}
								category={postCategory}
								variant={variant}
							/>
						);
					})
				}
			</ul>
		</section>
	</div>
</Layout>
